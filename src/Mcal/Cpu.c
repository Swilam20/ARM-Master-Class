/**********************************************************************************************************************
 *  FILE DESCRIPTION
 *  -----------------------------------------------------------------------------------------------------------------*/
/**        \file  Cpu.c
 *        \brief  
 *
 *      \details  
 *
 *
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  INCLUDES
 *********************************************************************************************************************/
#include "Std_Types.h"
#include "Cpu.h"
/**********************************************************************************************************************
*  LOCAL MACROS CONSTANT\FUNCTION
*********************************************************************************************************************/

/**********************************************************************************************************************
 *  LOCAL DATA 
 *********************************************************************************************************************/
unsigned char counter=0;
/**********************************************************************************************************************
 *  GLOBAL DATA
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  LOCAL FUNCTION PROTOTYPES
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  LOCAL FUNCTIONS
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  GLOBAL FUNCTIONS
 *********************************************************************************************************************/


/******************************************************************************
* \Syntax          : void Isr_SvcHandler(void)        
* \Description     :                                    
*                                                                             
* \Sync\Async      : Synchronous                                               
* \Reentrancy      : Non Reentrant                                             
* \Parameters (in) : None                     
* \Parameters (out): None                                                      
* \Return value:   : None
*******************************************************************************/
void Isr_SvcHandler(void){}

void CpuDriver_SwitchToPrivledgeMode(void)
{
	__asm(
		"SVC #0x1\n\t"		// handler mode
		"mov R0, #0x0\n\t"
		"MSR CONTROL, R0\n\t"
	);
}


void CpuDriver_SwitchToUserMode(void)
{
	__asm(
		"mov R0, #0x1\n\t"
		"MSR CONTROL, R0\n\t"
	);
}
void CpuDriver_EnableGlobalInterrupt(void)
{
	__asm(
		"CPSIE i\n\t"
		"CPSIE f\n\t"
		);
}
void CpuDriver_DisableGlobalInterrupt(void)
{
	__asm(
		"CPSID i\n\t"
		"CPSID f\n\t"
		);
}
void CpuDriver_StartCriticalSection(void)
{

	counter++;
	CpuDriver_DisableGlobalInterrupt();

}
void CpuDriver_StopCriticalSection(void)
{
	counter--;
	if(counter==0)
	{	CpuDriver_EnableGlobalInterrupt(); }

}
/**********************************************************************************************************************
 *  END OF FILE: Cpu.c
 *********************************************************************************************************************/
